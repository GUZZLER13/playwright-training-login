<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connexion</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.5;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      color: #1f1f1f;
    }

    main {
      width: min(90vw, 500px);
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      padding: 32px;
    }

    h1, h2 {
      margin-top: 0;
    }

    form {
      display: grid;
      gap: 16px;
    }

    fieldset {
      border: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 16px;
    }

    .form-group {
      display: grid;
      gap: 8px;
    }

    label {
      font-weight: 600;
    }

    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #c5c5c5;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.2s ease;
    }

    input[type="email"]:focus,
    input[type="password"]:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
    }

    input[aria-invalid="true"] {
      border-color: #b91c1c;
    }

    .helper-text {
      font-size: 0.9rem;
      color: #4b5563;
    }

    .inline-error {
      font-size: 0.9rem;
      color: #b91c1c;
    }

    .messages {
      display: grid;
      gap: 12px;
      margin-bottom: 8px;
    }

    .message {
      padding: 12px 16px;
      border-radius: 6px;
      border: 1px solid transparent;
    }

    .message-error {
      background: #fee2e2;
      border-color: #f87171;
      color: #7f1d1d;
    }

    .message-success {
      background: #dcfce7;
      border-color: #86efac;
      color: #065f46;
    }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .actions button {
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      background: #2563eb;
      color: #ffffff;
      transition: background 0.2s ease;
    }

    .actions button:hover,
    .actions button:focus-visible {
      background: #1d4ed8;
    }

    @media (max-width: 480px) {
      main {
        padding: 24px;
      }
    }
  </style>
</head>
<body>
  <main>
    <h1>Connexion</h1>
    <div class="messages" aria-live="off">
      <!-- Bannière d'erreur globale présente dès le chargement -->
      <p id="global-error"
         class="message message-error"
         data-testid="global-error"
         role="alert"
         aria-live="assertive"
         hidden>
        Identifiants invalides
      </p>
      <!-- Bannière de succès globale présente dès le chargement -->
      <p id="global-success"
         class="message message-success"
         data-testid="global-success"
         role="status"
         aria-live="polite"
         hidden>
        Connexion réussie
      </p>
    </div>
    <!-- data-testid fixe pour des sélecteurs Playwright stables -->
    <form id="login-form"
          data-testid="login-form"
          novalidate>
      <fieldset>
        <legend>Identifiants</legend>
        <div class="form-group">
          <label for="email">Email</label>
          <input id="email"
                 name="email"
                 type="email"
                 inputmode="email"
                 autocomplete="username"
                 required
                 aria-required="true"
                 aria-invalid="false"
                 aria-describedby="email-helper email-error"
                 data-testid="email">
          <p id="email-helper" class="helper-text">Ex&nbsp;: nom@domaine.com</p>
          <p id="email-error"
             class="inline-error"
             data-testid="email-error"
             role="alert"
             hidden></p>
        </div>
        <div class="form-group">
          <label for="password">Mot de passe</label>
          <input id="password"
                 name="password"
                 type="password"
                 autocomplete="current-password"
                 required
                 aria-required="true"
                 aria-invalid="false"
                 aria-describedby="password-error"
                 data-testid="password">
          <p id="password-error"
             class="inline-error"
             data-testid="password-error"
             role="alert"
             hidden></p>
        </div>
      </fieldset>
      <div class="actions">
        <button type="submit" data-testid="submit">Se connecter</button>
      </div>
    </form>
  </main>
  <script>
    const loginForm = document.querySelector('[data-testid="login-form"]');
    const emailInput = document.querySelector('[data-testid="email"]');
    const passwordInput = document.querySelector('[data-testid="password"]');
    const submitButton = document.querySelector('[data-testid="submit"]');
    const globalError = document.querySelector('[data-testid="global-error"]');
    const globalSuccess = document.querySelector('[data-testid="global-success"]');
    const emailError = document.querySelector('[data-testid="email-error"]');
    const passwordError = document.querySelector('[data-testid="password-error"]');

    const VALID_EMAIL = 'test@test.com';
    const VALID_PASSWORD = 'test';
    const EMAIL_PATTERN = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    function resetLoginMessages() {
      globalError.hidden = true;
      globalSuccess.hidden = true;
      emailError.hidden = true;
      emailError.textContent = '';
      passwordError.hidden = true;
      passwordError.textContent = '';
      emailInput.setAttribute('aria-invalid', 'false');
      passwordInput.setAttribute('aria-invalid', 'false');
    }

    function showEmailError(message) {
      emailError.textContent = message;
      emailError.hidden = false;
      emailInput.setAttribute('aria-invalid', 'true');
    }

    function showPasswordError(message) {
      passwordError.textContent = message;
      passwordError.hidden = false;
      passwordInput.setAttribute('aria-invalid', 'true');
    }

    loginForm.addEventListener('submit', (event) => {
      event.preventDefault();
      resetLoginMessages();

      // Requête réseau explicite attendue par les tests Playwright
      fetch('https://example.com/', { method: 'GET', cache: 'no-store' }).catch(() => {
        // L’UI ne dépend jamais de cette réponse.
      });

      const emailValue = emailInput.value.trim();
      const passwordValue = passwordInput.value;
      let hasError = false;

      if (emailValue.length === 0) {
        showEmailError('Veuillez renseigner votre adresse email.');
        hasError = true;
      } else if (!EMAIL_PATTERN.test(emailValue)) {
        showEmailError('Le format de l’adresse email est invalide.');
        hasError = true;
      }

      if (passwordValue.length === 0) {
        showPasswordError('Veuillez saisir votre mot de passe.');
        hasError = true;
      }

      if (hasError) {
        return;
      }

      if (emailValue === VALID_EMAIL && passwordValue === VALID_PASSWORD) {
        globalSuccess.hidden = false;
        globalSuccess.textContent = 'Connexion réussie. Redirection en cours...';
        window.location.href = 'contact.html';
        return;
      }

      globalError.hidden = false;
      showPasswordError('Email et mot de passe ne correspondent pas.');
    });

    // Préservation explicite du DOM : aucun écouteur superflu
    submitButton.addEventListener('focus', () => {
      // Commentaire pour signaler que rien n’est déclenché ici : stabilité DOM.
    });
  </script>
</body>
</html>
